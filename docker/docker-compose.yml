# Docker Compose for RepairShopr-Onyx Bridge
#
# Quick Start:
#   1. Copy .env.example to .env and fill in RS_SUBDOMAIN and RS_API_KEY
#   2. Run: docker-compose up -d
#
# For Onyx integration, uncomment the onyx-network section below.

version: '3.8'

services:
  repairshopr-connector:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: rs-onyx-connector
    restart: unless-stopped
    environment:
      # RepairShopr configuration (required)
      - RS_SUBDOMAIN=${RS_SUBDOMAIN:?Set RS_SUBDOMAIN in .env file}
      - RS_API_KEY=${RS_API_KEY:?Set RS_API_KEY in .env file}

      # Data selection
      - RS_INCLUDE_TICKETS=${RS_INCLUDE_TICKETS:-true}
      - RS_INCLUDE_CUSTOMERS=${RS_INCLUDE_CUSTOMERS:-true}
      - RS_INCLUDE_ASSETS=${RS_INCLUDE_ASSETS:-true}
      - RS_INCLUDE_INVOICES=${RS_INCLUDE_INVOICES:-false}

      # Sync configuration
      - RS_POLL_INTERVAL_MINUTES=${RS_POLL_INTERVAL_MINUTES:-10}
      - RS_REQUESTS_PER_MINUTE=${RS_REQUESTS_PER_MINUTE:-150}

      # Onyx configuration (if using Ingestion API)
      - ONYX_API_URL=${ONYX_API_URL:-http://onyx-api:8080}
      - ONYX_API_KEY=${ONYX_API_KEY:-}

      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      # Persist state for crash recovery
      - connector-state:/home/connector/.onyx-rs-bridge
    networks:
      - rs-connector-network
      # Uncomment below to connect to existing Onyx network:
      # - onyx-network

networks:
  # Default standalone network (always works)
  rs-connector-network:
    driver: bridge

  # Uncomment to connect to existing Onyx installation:
  # onyx-network:
  #   external: true
  #   name: onyx_default

volumes:
  connector-state:
